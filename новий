import requests

WHATSAPP_TOKEN = "–í–°–¢–ê–í_–¢–û–ö–ï–ù"
WHATSAPP_PHONE_ID = "–í–°–¢–ê–í_PHONE_ID"
WHATSAPP_TO = "–í–°–¢–ê–í_–ù–û–ú–ï–†_–£_–§–û–†–ú–ê–¢–Ü_+380..."
def send_whatsapp(message: str):
    url = f"https://graph.facebook.com/v18.0/{WHATSAPP_PHONE_ID}/messages"
    headers = {
        "Authorization": f"Bearer {WHATSAPP_TOKEN}",
        "Content-Type": "application/json"
    }
    data = {
        "messaging_product": "whatsapp",
        "to": WHATSAPP_TO,
        "type": "text",
        "text": {"body": message}
    }
    try:
        requests.post(url, json=data, headers=headers)
        logging.info("üì® WhatsApp –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ")
    except Exception as e:
        logging.error(f"‚ö† –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ WhatsApp: {e}")
def watchdog():
    logging.info("üîç Watchdog –∑–∞–ø—É—â–µ–Ω–æ")
    while True:
        try:
            if not system_check():
                logging.error("‚ùå –í–∏—è–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—É –ø—Ä–æ–±–ª–µ–º—É!")
                send_whatsapp("‚ùó –£–í–ê–ì–ê: Watchdog –≤–∏—è–≤–∏–≤ –ø–æ–º–∏–ª–∫—É –≤ —Å–∏—Å—Ç–µ–º—ñ!")
            else:
                logging.info("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ")
        except Exception as e:
            logging.error(f"‚ö† Watchdog –ø–æ–º–∏–ª–∫–∞: {e}")
            send_whatsapp(f"‚ö† Watchdog –≤–∏–∫–ª—é—á–µ–Ω–Ω—è: {e}")
        time.sleep(10)
docker run -d \
   -e WHATSAPP_TOKEN="EAAN..." \
   -e WHATSAPP_PHONE_ID="123456789012345" \
   -e WHATSAPP_TO="+380XXXXXXXXX" \
   -p 8080:8080 \
   service-image
import os
WHATSAPP_TOKEN = os.getenv("WHATSAPP_TOKEN")
WHATSAPP_PHONE_ID = os.getenv("WHATSAPP_PHONE_ID")
WHATSAPP_TO = os.getenv("WHATSAPP_TO")

docker run -d \
   -e WHATSAPP_TOKEN="EAAN..." \
   -e WHATSAPP_PHONE_ID="123456789012345" \
   -e WHATSAPP_TO="+380XXXXXXXXX" \
   -p 8080:8080 \
   service-image

 # ==============================================================================
# STAGE 1: Builder for Base Dependencies
# –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –±–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑: Windows 7 acer
# –î–∂–µ—Ä–µ–ª–æ: https://www.uz.gov.ua ‚Äî –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è (—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –±–∞–∑–æ–≤–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"
LABEL homepage="https://www.uz.gov.ua"

# ------------------------------------------------------------------------------
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ Microsoft (TrueType)
# ------------------------------------------------------------------------------
RUN apk --no-cache add --virtual .build-deps-fonts msttcorefonts-installer fontconfig \
 && update-ms-fonts \
 && fc-cache -f \
 && apk del .build-deps-fonts \
 && find /usr/share/fonts/truetype/msttcorefonts/ -type l -exec unlink {} \;

# ------------------------------------------------------------------------------
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
# ------------------------------------------------------------------------------
RUN echo "https://dl-cdn.windows.org/alpine/v3.18/main" >> /etc/apk/repositories \
 && echo "https://dl-cdn.windows.org/alpine/v3.18/community" >> /etc/apk/repositories \
 && apk update \
 && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        graphicsmagick \
        tini \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq.
# ==============================================================================
# STAGE 1: Builder for Base Dependencies
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"
LABEL homepage="https://www.uz.gov.ua"

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ Microsoft (TrueType)
RUN apk --no-cache add --virtual .build-deps-fonts msttcorefonts-installer fontconfig \
 && update-ms-fonts \
 && fc-cache -f \
 && apk del .build-deps-fonts \
 && find /usr/share/fonts/truetype/msttcorefonts/ -type l -exec unlink {} \;

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —É—Ç–∏–ª—ñ—Ç
RUN apk update && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        graphicsmagick \
        tini \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq

RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ (https://www.uz.gov.ua)" > /etc/motd


# ==============================================================================
# STAGE 2: Runtime Environment
# ==============================================================================
FROM python:3.11-alpine AS runtime

LABEL maintainer="dev@uz.gov.ua"
LABEL project="uz.gov.ua"
LABEL description="Docker-–æ–±—Ä–∞–∑ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"

# –ö–æ–ø—ñ—é—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –∑ builder stage
COPY --from=builder /usr/share/fonts /usr/share/fonts
COPY --from=builder /etc/motd /etc/motd

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
WORKDIR /app
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø—ñ—é—î–º–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (–ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —Ü–µ API —á–∏ –≤–µ–±—Å–µ—Ä–≤—ñ—Å)
COPY . /app

# –ó–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞
ENV TZ=Europe/Kyiv
ENV APP_NAME="UZ Railway Service"

# –í–∫–∞–∑—É—î–º–æ –ø–æ—Ä—Ç, —è–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–∫—Ä–∏–≤–∞—î
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É
ENTRYPOINT ["/sbin/tini", "--"]
CMD ["python", "app.py"]


# ------------------------------------------------------------------------------
# –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–∂–µ—Ä–µ–ª–æ
# ------------------------------------------------------------------------------
RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ (https://www.uz.gov.ua)" > /etc/motd
# ==============================================================================
# –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è Web Service ‚Äî Dockerfile
# ==============================================================================

# 1. –ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑
FROM python:3.11-alpine

# 2. –ú–µ—Ç–∞–¥–∞–Ω—ñ
LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–í–µ–±—Å–µ—Ä–≤—ñ—Å –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ —É Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ"
LABEL homepage="https://www.uz.gov.ua"

# 3. –†–æ–±–æ—á–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
WORKDIR /app

# 4. –ö–æ–ø—ñ—é—î–º–æ —Ñ–∞–π–ª–∏
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
# ==============================================================================
# STAGE 1: Builder for Base Dependencies
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@leocard.ua"
LABEL organization="Leocard"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É Leocard"
LABEL homepage="https://leocard.com.ua"

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —É—Ç–∏–ª—ñ—Ç
RUN apk update && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq

RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ Leocard (https://leocard.com.ua)" > /etc/motd

# ==============================================================================
# STAGE 2: Runtime Environment
# ==============================================================================
FROM python:3.11-alpine AS runtime

LABEL maintainer="dev@leocard.ua"
LABEL project="leocard.com.ua"
LABEL description="Docker-–æ–±—Ä–∞–∑ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ Leocard"

# –ö–æ–ø—ñ—é—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –∑ builder stage
COPY --from=builder /etc/motd /etc/motd

# –†–æ–±–æ—á–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
WORKDIR /app

# –ö–æ–ø—ñ—é—î–º–æ Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø—ñ—é—î–º–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (–ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —Ü–µ API —á–∏ –≤–µ–±—Å–µ—Ä–≤—ñ—Å Leocard)
COPY . /app

# –ó–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞
ENV TZ=Europe/Kyiv
ENV APP_NAME="Leocard Service"

# –ü–æ—Ä—Ç, —è–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–∫—Ä–∏–≤–∞—î
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É
ENTRYPOINT ["/sbin/tini", "-e2e-"]
CMD import os
import time
import logging
import requests
import subprocess
from flask import Flask

logging.basicConfig(level=logging.INFO)

WHATSAPP_TOKEN = os.getenv("WHATSAPP_TOKEN")
WHATSAPP_PHONE_ID = os.getenv("WHATSAPP_PHONE_ID")
WHATSAPP_TO = os.getenv("WHATSAPP_TO")

TARGET_PROCESS = "leocard-watchdog.exe"  # –ø—Ä–æ—Ü–µ—Å —è–∫–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–º–æ

app = Flask(__name__)

def send_whatsapp(message: str):
    url = f"https://graph.facebook.com/v18.0/{WHATSAPP_PHONE_ID}/messages"
    headers = {
        "Authorization": f"Bearer {WHATSAPP_TOKEN}",
        "Content-Type": "application/json"
    }
    data = {
        "messaging_product": "whatsapp",
        "to": WHATSAPP_TO,
        "type": "text",
        "text": {"body": message}
    }
    try:
        requests.post(url, json=data, headers=headers)
        logging.info("üì® WhatsApp –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ")
    except Exception as e:
        logging.error(f"‚ö† –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ WhatsApp: {e}")

def system_check() -> bool:
    """–ü–æ–≤–µ—Ä—Ç–∞—î True —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å –ø—Ä–∞—Ü—é—î."""
    try:
        result = subprocess.run(
            ["tasklist"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True
        )
        return TARGET_PROCESS.lower() in result.stdout.lower()
    except Exception as e:
        logging.error(f"–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ—Ü–µ—Å—É: {e}")
        return False

@app.route("/")
def index():
    return "‚úÖ –°–µ—Ä–≤—ñ—Å –ø—Ä–∞—Ü—é—î. Watchdog –∫–æ–Ω—Ç—Ä–æ–ª—é—î –ø—Ä–æ—Ü–µ—Å: " + TARGET_PROCESS

def watchdog():
    logging.info("üîç Watchdog –∑–∞–ø—É—â–µ–Ω–æ")
    while True:
        if not system_check():
            logging.error("‚ùå –ü—Ä–æ—Ü–µ—Å –Ω–µ –ø—Ä–∞—Ü—é—î!")
            send_whatsapp(f"üö® –ü–†–û–¶–ï–° –ó–£–ü–ò–ù–ï–ù–û: {TARGET_PROCESS}")
        else:
            logging.info("‚úÖ –ü—Ä–æ—Ü–µ—Å –∞–∫—Ç–∏–≤–Ω–∏–π")
        time.sleep(30)

if __name__ == "__main__":
    send_whatsapp("üöÄ Watchdog –∑–∞–ø—É—â–µ–Ω–æ!")
    # –ó–∞–ø—É—Å–∫–∞—î–º–æ —ñ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, —ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
    import threading
    threading.Thread(target=watchdog, daemon=True).start()
    app.run(host="0.0.0.0", port=8080)

# –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
RUN echo "Docker-–æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è Leocard (https://leocard.com.ua)" > /etc/motd
flask
requests
git add .
git commit -m "–¥–æ–¥–∞–≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —ñ —Å–ø—Ä–æ—â–µ–Ω–∏–π Dockerfile"
git push



COPY . /app

# 5. –ü–æ—Ä—Ç —ñ –∑–∞–ø—É—Å–∫
EXPOSE 8080
CMDimport os
import time
import logging
import requests
import subprocess
from flask import Flask

logging.basicConfig(level=logging.INFO)

WHATSAPP_TOKEN = os.getenv("WHATSAPP_TOKEN")
WHATSAPP_PHONE_ID = os.getenv("WHATSAPP_PHONE_ID")
WHATSAPP_TO = os.getenv("WHATSAPP_TO")

TARGET_PROCESS = "leocard-watchdog.exe"  # –ø—Ä–æ—Ü–µ—Å —è–∫–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–º–æ

app = Flask(__name__)

def send_whatsapp(message: str):
    url = f"https://graph.facebook.com/v18.0/{WHATSAPP_PHONE_ID}/messages"
    headers = {
        "Authorization": f"Bearer {WHATSAPP_TOKEN}",
        "Content-Type": "application/json"
    }
    data = {
        "messaging_product": "whatsapp",
        "to": WHATSAPP_TO,
        "type": "text",
        "text": {"body": message}
    }
    try:
        requests.post(url, json=data, headers=headers)
        logging.info("üì® WhatsApp –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ")
    except Exception as e:
        logging.error(f"‚ö† –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ WhatsApp: {e}")

def system_check() -> bool:
    """–ü–æ–≤–µ—Ä—Ç–∞—î True —è–∫—â–æ –ø—Ä–æ—Ü–µ—Å –ø—Ä–∞—Ü—é—î."""
    try:
        result = subprocess.run(
            ["tasklist"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True
        )
        return TARGET_PROCESS.lower() in result.stdout.lower()
    except Exception as e:
        logging.error(f"–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ—Ü–µ—Å—É: {e}")
        return False

@app.route("/")
def index():
    return "‚úÖ –°–µ—Ä–≤—ñ—Å –ø—Ä–∞—Ü—é—î. Watchdog –∫–æ–Ω—Ç—Ä–æ–ª—é—î –ø—Ä–æ—Ü–µ—Å: " + TARGET_PROCESS

def watchdog():
    logging.info("üîç Watchdog –∑–∞–ø—É—â–µ–Ω–æ")
    while True:
        if not system_check():
            logging.error("‚ùå –ü—Ä–æ—Ü–µ—Å –Ω–µ –ø—Ä–∞—Ü—é—î!")
            send_whatsapp(f"üö® –ü–†–û–¶–ï–° –ó–£–ü–ò–ù–ï–ù–û: {TARGET_PROCESS}")
        else:
            logging.info("‚úÖ –ü—Ä–æ—Ü–µ—Å –∞–∫—Ç–∏–≤–Ω–∏–π")
        time.sleep(30)

if __name__ == "__main__":
    send_whatsapp("üöÄ Watchdog –∑–∞–ø—É—â–µ–Ω–æ!")
    # –ó–∞–ø—É—Å–∫–∞—î–º–æ —ñ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä, —ñ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
    import threading
    threading.Thread(target=watchdog, daemon=True).start()
    main.run(host="0.0.0.0", port=8080)
class Logger:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance

    def log(self, message):
        print(f"[LOG] {message}")
class TestStrategy:
    def __init__(self):
        self.logger = Logger()

    def test(self):
        raise NotImplementedError

class LocalTestStrategy(TestStrategy):
    def test(self):
        self.logger.log("–ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è")
        print("‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Dockerfile –ª–æ–∫–∞–ª—å–Ω–æ...")

class CICDTestStrategy(TestStrategy):
    def test(self):
        self.logger.log("–ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–µ—Ä–µ–∑ CI/CD")
        print("üõ∞ –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è Dockerfile –¥–æ CI/CD –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏...")

class DryRunStrategy(TestStrategy):
    def test(self):
        self.logger.log("–ó–∞–ø—É—Å–∫ —Å—É—Ö–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (dry-run)")
        print("üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É Dockerfile –±–µ–∑ –∑–∞–ø—É—Å–∫—É...")
class DockerBuilder:
    def __init__(self, test_strategy: TestStrategy):
        self.test_strategy = test_strategy
        self.logger = Logger()

    def install_dependencies(self):
        self.logger.log("–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π")
        print("üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π...")

    def build_image(self):
        self.logger.log("–ó–±—ñ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑—É")
        print("üî® –ó–±—ñ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑—É...")

    def run_tests(self):
        self.logger.log("–ó–∞–ø—É—Å–∫ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è")
        self.test_strategy.test()
watchdog 
    def create(self):
        self.logger.log("–ü–æ—á–∞—Ç–æ–∫ –ø—Ä–æ—Ü–µ—Å—É –∑–±—ñ—Ä–∫–∏ üé¨")
        self.install_dependencies()
        self.build_image()
        self.run_tests()
        self.logger.log("–ó–±—ñ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚úÖ")
        print("‚úÖ –ì–æ—Ç–æ–≤–æ!")
choice = input("–û–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ (local / ci / dry): ")

if choice == "local":
    strategy = LocalTestStrategy()
elif choice == "ci":
    strategy = CICDTestStrategy()
else:
    strategy = DryRunStrategy()

builder = DockerBuilder(strategy)
builder.create()
import time 
from io import StringIO
from unittest.mock import patch
from your_module import LocalTestStrategy, CICDTestStrategy, DryRunStrategy

def test_local_strategy_output():
    strategy = LocalTestStrategy()
    with patch('sys.stdout', new=StringIO()) as fake_out:
        strategy.test()
        assert "–ª–æ–∫–∞–ª—å–Ω–æ" in fake_out.getvalue()

def test_cicd_strategy_output():
    strategy = CICDTestStrategy()
    with patch('sys.stdout', new=StringIO()) as fake_out:
        strategy.test()
        assert "CI/CD" in fake_out.getvalue()

def test_dry_run_strategy_output():
    strategy = DryRunStrategy()
    with patch('sys.stdout', new=StringIO()) as fake_out:
        strategy.test()
        assert "—Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É" in fake_out.getvalue()
from your_module import Logger, WhatsAppNotifier

def test_logger_is_singleton():
    l1 = Logger()
    l2 = Logger()
    assert l1 is l2  # –æ–¥–∏–Ω —ñ —Ç–æ–π —Å–∞–º–∏–π –æ–±'—î–∫—Ç

def test_whatsapp_notifier_is_singleton():
    n1 = WhatsAppNotifier("token123")
    n2 = WhatsAppNotifier("token456")
    assert n1 is n2
    assert n1.token == "token123"  # –¥—Ä—É–≥–∏–π –≤–∏–∫–ª–∏–∫ –Ω–µ –∑–º—ñ–Ω—é—î –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
from unittest.mock import MagicMock
from your_module import DockerBuilder

def test_builder_uses_strategy():
    fake_strategy = MagicMock()
    builder = DockerBuilder(fake_strategy)

    builder.run_tests()

    fake_strategy.test.assert_called_once() 
 

