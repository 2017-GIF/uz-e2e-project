import requests

WHATSAPP_TOKEN = "–í–°–¢–ê–í_–¢–û–ö–ï–ù"
WHATSAPP_PHONE_ID = "–í–°–¢–ê–í_PHONE_ID"
WHATSAPP_TO = "–í–°–¢–ê–í_–ù–û–ú–ï–†_–£_–§–û–†–ú–ê–¢–Ü_+380..."
def send_whatsapp(message: str):
    url = f"https://graph.facebook.com/v18.0/{WHATSAPP_PHONE_ID}/messages"
    headers = {
        "Authorization": f"Bearer {WHATSAPP_TOKEN}",
        "Content-Type": "application/json"
    }
    data = {
        "messaging_product": "whatsapp",
        "to": WHATSAPP_TO,
        "type": "text",
        "text": {"body": message}
    }
    try:
        requests.post(url, json=data, headers=headers)
        logging.info("üì® WhatsApp –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ")
    except Exception as e:
        logging.error(f"‚ö† –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ WhatsApp: {e}")
def watchdog():
    logging.info("üîç Watchdog –∑–∞–ø—É—â–µ–Ω–æ")
    while True:
        try:
            if not system_check():
                logging.error("‚ùå –í–∏—è–≤–ª–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω—É –ø—Ä–æ–±–ª–µ–º—É!")
                send_whatsapp("‚ùó –£–í–ê–ì–ê: Watchdog –≤–∏—è–≤–∏–≤ –ø–æ–º–∏–ª–∫—É –≤ —Å–∏—Å—Ç–µ–º—ñ!")
            else:
                logging.info("‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î —Å—Ç–∞–±—ñ–ª—å–Ω–æ")
        except Exception as e:
            logging.error(f"‚ö† Watchdog –ø–æ–º–∏–ª–∫–∞: {e}")
            send_whatsapp(f"‚ö† Watchdog –≤–∏–∫–ª—é—á–µ–Ω–Ω—è: {e}")
        time.sleep(10)
docker run -d \
   -e WHATSAPP_TOKEN="EAAN..." \
   -e WHATSAPP_PHONE_ID="123456789012345" \
   -e WHATSAPP_TO="+380XXXXXXXXX" \
   -p 8080:8080 \
   service-image
import os
WHATSAPP_TOKEN = os.getenv("WHATSAPP_TOKEN")
WHATSAPP_PHONE_ID = os.getenv("WHATSAPP_PHONE_ID")
WHATSAPP_TO = os.getenv("WHATSAPP_TO")

docker run -d \
   -e WHATSAPP_TOKEN="EAAN..." \
   -e WHATSAPP_PHONE_ID="123456789012345" \
   -e WHATSAPP_TO="+380XXXXXXXXX" \
   -p 8080:8080 \
   service-image

 # ==============================================================================
# STAGE 1: Builder for Base Dependencies
# –û—Ñ—ñ—Ü—ñ–π–Ω–∏–π –±–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑: Windows 7 acer
# –î–∂–µ—Ä–µ–ª–æ: https://www.uz.gov.ua ‚Äî –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è (—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è)
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –±–∞–∑–æ–≤–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"
LABEL homepage="https://www.uz.gov.ua"

# ------------------------------------------------------------------------------
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ Microsoft (TrueType)
# ------------------------------------------------------------------------------
RUN apk --no-cache add --virtual .build-deps-fonts msttcorefonts-installer fontconfig \
 && update-ms-fonts \
 && fc-cache -f \
 && apk del .build-deps-fonts \
 && find /usr/share/fonts/truetype/msttcorefonts/ -type l -exec unlink {} \;

# ------------------------------------------------------------------------------
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
# ------------------------------------------------------------------------------
RUN echo "https://dl-cdn.windows.org/alpine/v3.18/main" >> /etc/apk/repositories \
 && echo "https://dl-cdn.windows.org/alpine/v3.18/community" >> /etc/apk/repositories \
 && apk update \
 && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        graphicsmagick \
        tini \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq.
# ==============================================================================
# STAGE 1: Builder for Base Dependencies
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"
LABEL homepage="https://www.uz.gov.ua"

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—ñ–≤ Microsoft (TrueType)
RUN apk --no-cache add --virtual .build-deps-fonts msttcorefonts-installer fontconfig \
 && update-ms-fonts \
 && fc-cache -f \
 && apk del .build-deps-fonts \
 && find /usr/share/fonts/truetype/msttcorefonts/ -type l -exec unlink {} \;

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —É—Ç–∏–ª—ñ—Ç
RUN apk update && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        graphicsmagick \
        tini \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq

RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ (https://www.uz.gov.ua)" > /etc/motd


# ==============================================================================
# STAGE 2: Runtime Environment
# ==============================================================================
FROM python:3.11-alpine AS runtime

LABEL maintainer="dev@uz.gov.ua"
LABEL project="uz.gov.ua"
LABEL description="Docker-–æ–±—Ä–∞–∑ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ"

# –ö–æ–ø—ñ—é—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –∑ builder stage
COPY --from=builder /usr/share/fonts /usr/share/fonts
COPY --from=builder /etc/motd /etc/motd

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
WORKDIR /app
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø—ñ—é—î–º–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (–ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —Ü–µ API —á–∏ –≤–µ–±—Å–µ—Ä–≤—ñ—Å)
COPY . /app

# –ó–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞
ENV TZ=Europe/Kyiv
ENV APP_NAME="UZ Railway Service"

# –í–∫–∞–∑—É—î–º–æ –ø–æ—Ä—Ç, —è–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–∫—Ä–∏–≤–∞—î
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É
ENTRYPOINT ["/sbin/tini", "--"]
CMD ["python", "app.py"]


# ------------------------------------------------------------------------------
# –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–∂–µ—Ä–µ–ª–æ
# ------------------------------------------------------------------------------
RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ (https://www.uz.gov.ua)" > /etc/motd
# ==============================================================================
# –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è Web Service ‚Äî Dockerfile
# ==============================================================================

# 1. –ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑
FROM python:3.11-alpine

# 2. –ú–µ—Ç–∞–¥–∞–Ω—ñ
LABEL maintainer="dev@uz.gov.ua"
LABEL organization="–£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—è"
LABEL description="–í–µ–±—Å–µ—Ä–≤—ñ—Å –£–∫—Ä–∑–∞–ª—ñ–∑–Ω–∏—Ü—ñ —É Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ"
LABEL homepage="https://www.uz.gov.ua"

# 3. –†–æ–±–æ—á–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
WORKDIR /app

# 4. –ö–æ–ø—ñ—é—î–º–æ —Ñ–∞–π–ª–∏
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
# ==============================================================================
# STAGE 1: Builder for Base Dependencies
# ==============================================================================
FROM alpine:3.18 AS builder

LABEL maintainer="dev@leocard.ua"
LABEL organization="Leocard"
LABEL description="–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ –∑ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É Leocard"
LABEL homepage="https://leocard.com.ua"

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö —É—Ç–∏–ª—ñ—Ç
RUN apk update && apk add --no-cache \
        libxml2 \
        git \
        openssh \
        openssl \
        tzdata \
        ca-certificates \
        libc6-compat \
        jq

RUN echo "–ë–∞–∑–æ–≤–∏–π –æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ Leocard (https://leocard.com.ua)" > /etc/motd

# ==============================================================================
# STAGE 2: Runtime Environment
# ==============================================================================
FROM python:3.11-alpine AS runtime

LABEL maintainer="dev@leocard.ua"
LABEL project="leocard.com.ua"
LABEL description="Docker-–æ–±—Ä–∞–∑ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤ Leocard"

# –ö–æ–ø—ñ—é—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ –∑ builder stage
COPY --from=builder /etc/motd /etc/motd

# –†–æ–±–æ—á–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è
WORKDIR /app

# –ö–æ–ø—ñ—é—î–º–æ Python-–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø—ñ—é—î–º–æ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ (–ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —Ü–µ API —á–∏ –≤–µ–±—Å–µ—Ä–≤—ñ—Å Leocard)
COPY . /app

# –ó–º—ñ–Ω–Ω–∞ –æ—Ç–æ—á–µ–Ω–Ω—è ‚Äî —Ç–∞–π–º–∑–æ–Ω–∞ –£–∫—Ä–∞—ó–Ω–∞
ENV TZ=Europe/Kyiv
ENV APP_NAME="Leocard Service"

# –ü–æ—Ä—Ç, —è–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—ñ–¥–∫—Ä–∏–≤–∞—î
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É
ENTRYPOINT ["/sbin/tini", "--"]
CMD ["python", "main/appy"]
d
# –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
RUN echo "Docker-–æ–±—Ä–∞–∑ —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è Leocard (https://leocard.com.ua)" > /etc/motd
flask
requests
git add .
git commit -m "–¥–æ–¥–∞–≤ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä —ñ —Å–ø—Ä–æ—â–µ–Ω–∏–π Dockerfile"
git push



COPY . /app

# 5. –ü–æ—Ä—Ç —ñ –∑–∞–ø—É—Å–∫
EXPOSE 8080
CMD ["python", "app.py]
